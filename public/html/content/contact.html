<div class="contact">
  <div class="sub_title">
    <h2>CONTACT US</h2>
    <p>DEFINE으로 편하게 문의해 주세요</p>
  </div>
  <div class="sub_visual">
    <img src="../../images/content/visual_contact.jpg" alt="" />
  </div>
  <article class="sub_content">
    <p class="sub_content_summary">DEFINE Business Contact</p>
    <h3 class="sub_content_title">디파인은 고객님의 필요에<br>맞춘 서비스를 제공하기 위해<br><em>항상 최선을 다합니다.</em></h3>
    <h4 class="sub_content_addition">궁금한 사항이나 문의가 있으시면 언제든지 문의 부탁드립니다.<br>
      디파인은 항상 여러분의 성공을 지원하는 파트너가 되어 드리겠습니다.</h4>
    <form id="contactForm">
      <div class="email_form">
        <div class="email_form_sort">
          <label for="category">분야</label>
          <div class="select_wrap">
            <select id="category" name="category" required>
              <option value="">Select</option>
              <option value="특허 - 기계">특허 - 기계</option>
              <option value="특허 - 소프트웨어">특허 - 소프트웨어</option>
              <option value="특허 - 전기/전자">특허 - 전기/전자</option>
              <option value="특허 - 화학/재료">특허 - 화학/재료</option>
              <option value="상표">상표</option>
              <option value="디자인">디자인</option>
              <option value="기타">기타</option>
            </select>
          </div>
        </div>
        <div class="email_form_sort">
          <label for="name">이름</label>
          <input type="text" id="name" name="name" placeholder="이름을 입력해 주세요" required>
        </div>
        <div class="email_form_sort">
          <label for="company">회사명</label>
          <input type="text" id="company" name="company" placeholder="회사명을 입력해 주세요">
        </div>
        <div class="email_form_sort">
          <label for="phone">전화번호</label>
          <input type="text" id="phone" name="phone" placeholder="전화번호를 입력해 주세요">
        </div>
        <div class="email_form_sort">
          <label for="email">이메일</label>
          <input type="email" id="email" name="email" placeholder="이메일을 입력해 주세요" required>
        </div>
        <div class="email_form_sort">
          <label for="qna">문의내용</label>
          <textarea id="qna" name="qna" placeholder="문의내용을 입력해 주세요" required></textarea>
        </div>
      </div>
      <button class="email_send" type="submit">
        문의하기
        <span class="icon_arrow"><img src="../../images/common/icon_arrow.svg" alt="arrow"></span>
      </button>
    </form>      
  </article>
</div>

<script>
  document.getElementById('contactForm').addEventListener('submit', async function (e) {
    e.preventDefault(); // 폼 제출 기본 동작 막기 (페이지 리로드 방지)

    // 폼 데이터 수집
    const formData = {
      category: document.getElementById('category').value,
      name: document.getElementById('name').value,
      company: document.getElementById('company').value,
      phone: document.getElementById('phone').value,
      email: document.getElementById('email').value,
      qna: document.getElementById('qna').value,
    };

    // 폼 데이터를 서버로 전송
    try {
      const response = await fetch('/api/send-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData),
      });

      console.log('Response status:', response.status); // 응답 상태 확인
      // 응답 상태 확인
      if (!response.ok) {
        throw new Error('전송 중 오류가 발생했습니다.');
      }

      const responseData = await response.json();
      console.log('Response Data:', responseData); // 서버 응답 내용 확인
      alert(responseData.message); // 성공 메시지
      document.getElementById('contactForm').reset(); // 폼 초기화
    } catch (err) {
      console.error('Error:', err); // 에러 내용 출력
      alert('전송 실패'); // 오류 메시지
    }
  });
</script>